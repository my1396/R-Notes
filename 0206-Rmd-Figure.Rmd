## Figures

Specify code chunk options `fig.width` and `fig.height` for R-generated figures only.

- Default is `fig.width = 7` and `fig.height = 5` (in inches, though actual width will depend on screen resolution). Remember that these settings will default to `rmarkdown` values, not `knitr` values.
- If don't know what size is suitable, can right-click the Plots Viewer and choose "Copy Image Address". Scale by `/100` and fill the values to chunk options.



`out.width` and `out.height` apply to both existing images and R-generated figures.

- note that the percentage need to be put in quotes.
- `fig.width` do not scale font, it shows the original font size.
- `out.width` scales the whole figure. Better to use this one. If you want to fix aspect ratio, use `fig.asp=0.6` to set height:width = 6:10.

~~~~markdown
```{r car-plot, eval=TRUE, echo=FALSE, out.width="20%", fig.cap="Caption here." }`r ''`
knitr::include_graphics(img1_path) 
```
~~~~

`fig.cap=NULL`  specify figure captions. Must provide `fig.cap` if you need to cross reference the figure.

See <span style='color:#00CC66'>`Fig. \@ref(fig:car-plot)`</span>  use code chunk label to cross reference. The chunk label (`car-plot`) provides the identifier for referencing the figure generated by the chunk.

- `Fig.&nbsp;\@ref(fig:logit-regression)` use `&nbsp;` to insert a <span style='color:#00CC66'>non-breaking space</span>.

<span style='color:#00CC66'>`fig.align="center"`</span> to set figure alignment.

`fig.pos="H"` fix placement.

` fig.asp=0.6` aspect ratio height:width=6:10.



<span style='color:#00CC66'>**Suggested practice**</span> so that you have correct aspect ratio and automatically scaled text and labels in figures.

1. generate the figure and save to local

   The benefit is that you have full control to adjust the figure as needed, such as font size, and could reuse it later.

   ````markdown
   ```{r echo=FALSE, include=FALSE}`r ''`
   p <- ggplot(contingency_table %>% 
              as_tibble() %>% 
              mutate(chd69=factor(chd69, levels=c("non-developed", "developed"))), 
          aes(x=smoke, y=n, fill=chd69)) +
       geom_bar(position="stack", stat="identity", color="black", linewidth=0.1) + 
       scale_fill_grey(start=0.88, end=0.7) +
       labs(y="Frequency") +
       theme(axis.title.x = element_blank(), legend.position = "bottom")
   f_name <- "images/stacked_bar.png"
   plot_png(p, f_name, 5.17, 5)
   ```
   ````

   Specify chunk options <span style='color:#00CC66'>`include=FALSE`</span> (Do not include code output) to suppress the graphic window information like the following.

   ```r
   ## quartz_off_screen 
   ##                 2
   ```

2. add the figure using 

   ````markdown
   ```{r scatter-plot, echo=FALSE, fig.cap="Scatter plot of avearge wage against experience.", out.width = "80%"}`r ''`
   include_graphics(f_name)
   ```
   ````

3. cross reference 

   - `pdf_document`: using `\autoref{fig:scatter-plot}` from `hyperref` package or `Fig. \ref{fig:scatter-plot}` from base latex.

     `hyperref` uses `Figure`, could be changed to `Fig.` by putting the following cmd at the begin of the Rmd.

     ```latex
     \renewcommand\figureautorefname{Fig.}
     ```

   - `bookdown::html_document2`: using `\@ref(fig:scatter-plot)`.



Latex symbols in Fig. caption

- `\\Phi` works. You need to escape the `\` in `\Phi` .
- Suggested to use R code blocks to include figures. If using html, the numbering will be messed up. There is only automatic numbering with R code figures.

````r
```{r fig.cap="The $\\Phi$ and $\\phi$ ($f_Z(.)$) functions (CDF and pdf of standard normal).", out.width="70%", echo=FALSE}`r ''`
include_graphics("https://drive.google.com/thumbnail?id=1nxfdIKXgZvOqXVSeA3h_hf0yxmsM361l&sz=w1000")
```
````

- Alternatively, use html, enclode the caption inside `<figcaption>`. 

  Drawback: You need to manually add figure numberings.

```html
<figure> 
<img src="https://drive.google.com/thumbnail?id=1nxfdIKXgZvOqXVSeA3h_hf0yxmsM361l&sz=w1000" alt="Phi_b" style="display: block; margin-right: auto; margin-left: auto; zoom:80%;" />
<figcaption>Fig.1 The $\Phi$ and $\phi$ ($f_Z(.)$) functions (CDF and pdf of standard normal).</figcaption>
</figure>
```



Refer to another figure in figure caption

Need to use double backslash  `\\@ref(fig:xxx)`.

````markdown
```{r figure-1, fig.cap="Figure1"}`r ''`
ggplot()
```
Now a second plot with a reference to Fig.: \@ref(fig:figure-1).

```{r secondplot, fig.cap = "This is the same as Fig.: \\@ref(fig:firstplot) 
but now with a red line." }`r ''`
library(ggplot2)
plot_A + geom_line(alpha = .75,col = "red")
```
````


